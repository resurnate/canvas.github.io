<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta property="og:url" content="https://canvas.resurnate.com/index.html">
  <meta property="og:type" content="website">
  <meta property="og:title" content="Resurnate Canvas Wizard">
  <meta property="og:description" content="The Canvas tool enables a content provider to create a comic strip for Resurnate.com.">
  <title>Canvas Wizard</title>
  <link rel="stylesheet" href="/css/main.css">
  <script type="text/javascript">

    function _peekInit(panelId) {
      let imageElement = panelId+'b';
      let imageLabel = document.getElementById(imageElement).value;
      let imageLabels = [ imageLabel ];
      let imageURLs = prepareImages(window.location.origin,imageLabels);
      peekPanelId = panelId;
      loadImages(imageURLs,_peekAtPanel,_loadError);
    }

    function _peekJson(panelId) {
      let peekElement = document.getElementById(panelId+'-peek');
      peekElement.style.display = 'none';
      let jsonElement = document.getElementById(panelId+'-json');
      jsonElement.style.display = 'flex';
    }

    function _peekHide(panelId) {
      let peekElement = document.getElementById(panelId+'-peek');
      peekElement.style.display = 'none';
      let jsonElement = document.getElementById(panelId+'-json');
      jsonElement.style.display = 'none';
    }

    function _peekAtPanel(images) {
      // Remove previous peek
      let peekElement = document.getElementById(peekPanelId+'-peek');
      let canvasElement =  document.getElementById(peekPanelId+'canvas');
      if (canvasElement !== null) {
        peekElement.removeChild(canvasElement);
      }
      // Remove previous JSON
      let jsonElement = document.getElementById(peekPanelId+'-json');
      let preElement =  document.getElementById(peekPanelId+'pre');
      if (preElement !== null) {
        jsonElement.removeChild(preElement);
      }
      _peekParsePrepareAndDraw(images);
    }

    function _loadError(url) {
      alert('Failed to load one or more images: ' + url);
      peekPanelId = '';
    }

    function _peekParsePrepareAndDraw(images) {
      _inputPeek(peekPanelId);
      let prepared = _canvasPrepare(images);
      _canvasDraw(peekPanelId,prepared);
    }

    function _canvasPrepare(images) {
      let canvas = document.createElement('canvas');
      let context = canvas.getContext('2d');
      let filtered = prepareCanvas(context,input,images);
      let pre = document.createElement('pre');
      pre.innerText = JSON.stringify(input.panels[0],null,2);
      return {
        canvas   : canvas,
        filtered : filtered,
        pre      : pre
      };
    }

    function _canvasDraw(panelId,prepared) {
      // Peek
      prepared.canvas.id     = panelId+'canvas';
      prepared.canvas.width  = prepared.filtered.w;
      prepared.canvas.height = prepared.filtered.h;
      prepared.canvas.style = "width: 100%";
      let peek = document.getElementById(panelId+'-peek');
      peek.style.display = 'flex';
      peek.appendChild(prepared.canvas);
      drawCanvas(prepared.filtered,false);
      // JSON
      prepared.pre.id = panelId+'pre';
      let json = document.getElementById(panelId+'-json');
      json.style.display = 'none';
      json.appendChild(prepared.pre);
    }

  </script>
</head>
<body onload="_initPage();">

<!-- Header -->
<div id="header">
  <h1 class="title"><a href="/">Resurnate</a></h1>
</div>

<!-- Menu -->
<div id="menu">
  <a class="item" href="/">Tool</a>
  <span style="color: white">&#10192;</span>
  <a class="item" href="/help.html">Help</a>
</div>

<!-- Title -->
<h1>Canvas Wizard</h1>
<ul>
  <li>This tool enables a content provider to create a comic strip for <a href="https://resurnate.com" target="_blank">Resurnate.com</a>.</li>
</ul>

<!-- Panel Sections -->
<div class="wizard-sections" id="panel-sections">
</div>

<!-- Footer -->
<br>
<p class="line">&nbsp;</p>
<div id="footer">
  <p><a href="/privacy.html">Privacy</a></p>
  <p class="copyright">&#169; 2023 resurnate.com</p>
</div>

<!-- Modal -->
<div id="modal" class="modal">
  <div class="modal-content">
    <span class="close">&times;</span>
    <div id="preview"></div>
  </div>
</div>

<script>

  const MODAL_ELEMENT = 'modal';
  // const BUTTON_ELEMENT = 'strip-preview';
  const CLOSE_ELEMENT = 'close';

  let modal = document.getElementById(MODAL_ELEMENT);
  // let btn = document.getElementById(BUTTON_ELEMENT);
  let span = document.getElementsByClassName(CLOSE_ELEMENT)[0];

  // // Open modal and preview
  // btn.onclick = function() {
  //   modal.style.display = "block";
  //   preview();
  // }

  // When <span> (x) clicked, close modal
  span.onclick = function() {
    modal.style.display = "none";
  }

  // When anywhere outside modal clicked, close it
  window.onclick = function(event) {
    if (event.target === modal) {
      modal.style.display = "none";
    }
  }

</script>
<script type="text/javascript" src="/js/wizard.js"></script>
<script type="text/javascript" src="/js/main.js"></script>
<script type="text/javascript" src="/js/canvas.js"></script>
</body>
</html>